<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>SystemThink Tech Group Cloud NLP Service PoC 2019/2020</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Template by FREEHTML5.CO" />
	<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
	<meta name="author" content="FREEHTML5.CO" />

  	<!-- 
	//////////////////////////////////////////////////////

	FREE HTML5 TEMPLATE 
	DESIGNED & DEVELOPED by FREEHTML5.CO
	
	Website: 		http://freehtml5.co/
	Email: 			info@freehtml5.co
	Twitter: 		http://twitter.com/fh5co
	Facebook: 	https://www.facebook.com/fh5co

	//////////////////////////////////////////////////////
	 -->

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

  	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
  	<link rel="shortcut icon" href="favicon.ico">

  	<!-- Google Webfont -->
	<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
	<!-- Themify Icons -->
	<link rel="stylesheet" href="css/themify-icons.css">
	<!-- Bootstrap -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">
	<!-- Superfish -->
	<link rel="stylesheet" href="css/superfish.css">
	<!-- Easy Responsive Tabs -->
	<link rel="stylesheet" href="css/easy-responsive-tabs.css">
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Theme Style -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	</head>
	<body class="inner-page">
		<!-- START #fh5co-header -->
		<header id="fh5co-header-section" role="header" class="" >
			<div class="container">
					<h1 id="fh5co-logo" class="pull-left"><a href="index.html"><img src="images/logo.png" alt="Valet Free HTML5 Template"></a></h1>
			</div>
		</header>


		<div id="fh5co-hero" style="background-image: url(images/slide_2.jpg);">
			<div class="overlay"></div>
			<a href="#fh5co-main" class="smoothscroll fh5co-arrow to-animate hero-animate-4"><i class="ti-angle-down"></i></a>
			<!-- End fh5co-arrow -->
			<div class="container">
				<div class="col-md-12">
					<div class="fh5co-hero-wrap">
						<div class="fh5co-hero-intro">
							<h1 class="to-animate hero-animate-1">Azure Coginitive Services Translatorを利用した<br>英語－＞日本語翻訳機能</h1>
							<h2 class="to-animate hero-animate-2">AzureのAI/機械学習系サービス Coginitive Servicesの中のTranslatorサービスを利用し、英文テキストを日本語に翻訳し表示する</h2>
						</div>
					</div>
				</div>
			</div>		
		</div>

		<div id="fh5co-main">
			<div id="fh5co-contact">
			<div class="container">
				<div style="display: none;">
					<!-- 認証関連オブジェクト -->
					<input id="subscriptionKey" type="text" size="40" value="subscription">
					<input id="serviceRegion" type="text" size="40" value="YourServiceRegion">
				</div>

				<div class="row">
					<div class="col-md-8">
						<form action="#" method="post">
							<div class="col-md-12">
								<div class="form-group">
									<label for="targetText" class="sr-only">翻訳対象テキスト（英語）</label>
									<textarea placeholder="翻訳したい英文テキストを入力" id="targetText" class="form-control input-lg" rows="12"></textarea>
								</div>	
							</div>
							<div class="col-md-12">
								<div class="form-group">
									<input type="button" id="startTranslateButton" class="btn btn-primary btn-lg " value="Send">

								</div>	
							</div>
							<div class="col-md-12">
								<div class="form-group">
									<label for="results" class="sr-only">翻訳処理後テキスト（日本語）</label>
									<textarea placeholder="翻訳語の日本語を表示" id="results" class="form-control input-lg" rows="12" readonly></textarea>
								</div>	
							</div>
							
							
						</form>	
						
					</div>
					<div class="col-md-4">
						<h3>操作説明</h3>
						<p>
							上の英文テキスト入力欄を入力後、「SEND」ボタンをクリックすると、下のテキスト欄に日本語翻訳が表示されます。<br>
							内部的には以下のような処理で構成されています。<br>
							<p>
								<ol>
									<li>事前にAzureサービスより発行される認証用のサブスクリプションキーをもとに、一時的な認証トークンを取得（PHP）</li>
									<li>SENDボタンクリックでAzureのTranslatorサービスへ、英文テキストを含むHTTPリクエストを送信</li>
									<li>Translatorサービスで処理された結果を受信し、翻訳語テキストエリアへ表示</li>
								</ol>
							</p>
							Azure Translatorサービスの制限により、英文テキストは5000文字までとされており、それ以上のテキストを送信するとエラーが発生します。
						</p>
					</div>


				</div>
			</div>

			</div>
			<!-- fh5co-contact -->

		
		</div>
		<!-- END fhtco-main -->


		<footer role="contentinfo" id="fh5co-footer">
			<a href="#" class="fh5co-arrow fh5co-gotop footer-box"><i class="ti-angle-up"></i></a>
			<div class="container">
				<!-- END row -->
				<div class="fh5co-spacer fh5co-spacer-md"></div>
			</div>
		</footer>
			
  <!-- </uidiv> -->
  <script type="text/javascript" src="lib/uuid.js"></script>
  <!-- <authorizationfunction> -->
  <!-- Speech SDK Authorization token -->
  <script>
  // Note: Replace the URL with a valid endpoint to retrieve
  //       authorization tokens for your subscription.
  var authorizationEndpoint = "php/tokenTranslator.php";

  function RequestAuthorizationToken() {
    if (authorizationEndpoint) {
      var a = new XMLHttpRequest();
      a.open("GET", authorizationEndpoint);
      a.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      a.send("");
      a.onload = function() {
          var token = JSON.parse(atob(this.responseText.split(".")[1]));
          serviceRegion.value = token.region;
          authorizationToken = this.responseText;
          subscriptionKey.disabled = true;
          subscriptionKey.value = "using authorization token (hit F5 to refresh)";
          console.log("Got an authorization token: " + token);
      }
    }
  }
  </script>
  <!-- </authorizationfunction> -->

  <script>
    // status fields and start button in UI
    var phraseDiv;
    var startTranslateButton;

    // subscription key and region for speech services.
    var subscriptionKey, serviceRegion;
    var authorizationToken;
    var recognizer;

    //選択されたファイルを取得
    var strTarget = "";

    document.addEventListener("DOMContentLoaded", function () {
      startTranslateButton = document.getElementById("startTranslateButton");
      subscriptionKey = document.getElementById("subscriptionKey");
      serviceRegion = document.getElementById("serviceRegion");
      phraseDiv = document.getElementById("phraseDiv");
      targetText = document.getElementById('targetText');
      results = document.getElementById('results');
/*
      //ファイル選択されたタイミングでテキストファイルの中身を取得
      targetText.addEventListener("change", function(event) {
        const file = event.target.files;
        //FileReaderのインスタンスを作成する
        var reader = new FileReader();
        reader.readAsText(file[0]);
        //ファイルの中身を取得後に処理を行う
        reader.addEventListener( 'load', function() {
          //読み込んだファイルの中身を取得する
          strTarget = reader.result;
          //ダブルクォーテーション除去
          if(strTarget.startsWith("\"")){
            strTarget = strTarget.slice(1);
          }
          if(strTarget.endsWith("\"")){
            strTarget = strTarget.slice(0,-1);
          }
        })
      });
*/
      startTranslateButton.addEventListener("click", function () {
        startTranslateButton.disabled = true;
        results.value = "";

        const requestJson = {"Text": targetText.value};

        var requestURL = "https://api.cognitive.microsofttranslator.com/translate?api-version=3.0";
        const req_from = "en";
        const req_to = "ja";

        requestURL += "&from=" + req_from + "&to=" + req_to;

        const initParams = {
          "method": "POST",
          "headers": {
            "Authorization": "Bearer " + authorizationToken,
//            "Ocp-Apim-Subscription-Key": "ceabc2e05f094851a140e0dc9fc27eaf", 
            "Content-Type": "application/json; charset=UTF-8",
          },          
          "body": JSON.stringify([requestJson]),
        };

        fetch(requestURL, initParams).then((response) => {
          if(response.ok) { // ステータスがokならば
            return response.json(); //responseのJSON=次のthenの引数dataに送られる
          } else {
            throw new Error();
          }
        })
        .then((data) => {
          console.log(JSON.stringify(data));
          results.value = data[0].translations[0].text;
        })
        .catch((error) => console.log(error));
/*
        var request = new XMLHttpRequest();
  
        request.open("POST", requestURL);
        request.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
        request.setRequestHeader("Authorization", "Bearer " + authorizationToken);
        request.setRequestHeader("X-ClientTraceId", UUID.generate());

        request.send(requestParam + "&body=" + requestJson);
//        request.send(requestJson);

        request.onload = function() {
          console.log(JSON.stringify(this.responseText) );
          phraseDiv.innerHTML = JSON.stringify(this.responseText);
        }
*/
        startTranslateButton.disabled = false;

      });

      // in case we have a function for getting an authorization token, call it.
      if (typeof RequestAuthorizationToken === "function") {
          RequestAuthorizationToken();
      }
    });
  </script>
			
		<!-- jQuery -->
		<script src="js/jquery-1.10.2.min.js"></script>
		<!-- jQuery Easing -->
		<script src="js/jquery.easing.1.3.js"></script>
		<!-- Bootstrap -->
		<script src="js/bootstrap.js"></script>
		<!-- Owl carousel -->
		<script src="js/owl.carousel.min.js"></script>
		<!-- Magnific Popup -->
		<script src="js/jquery.magnific-popup.min.js"></script>
		<!-- Superfish -->
		<script src="js/hoverIntent.js"></script>
		<script src="js/superfish.js"></script>
		<!-- Easy Responsive Tabs -->
		<script src="js/easyResponsiveTabs.js"></script>
		<!-- FastClick for Mobile/Tablets -->
		<script src="js/fastclick.js"></script>
		<!-- Waypoints -->
		<script src="js/jquery.waypoints.min.js"></script>

		<!-- Main JS -->
		<script src="js/main.js"></script>

	</body>
</html>
